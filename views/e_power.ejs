<%- include common/header.ejs %>
<div class="container-fluid">
    <%- include common/menu.ejs %>
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <ul class="nav nav-pills">
            <li id="bydays"><a href="/e_power/bydays">Days</a></li>
            <li id="bymonth"><a href="/e_power/bymonth">Months</a></li>
            <li id="byyear"><a href="/e_power/byyear">Year</a></li>
            <li id="bytotal"><a href="/e_power/bytotal">Total</a></li>
        </ul>
        <input name="period" id="period" value="<%= period %>" type="hidden"/>

        <div class="form-group">
            <label for="dtp_input2" style="padding-top: 5px;padding-left: 0;" class="col-md-2 control-label">Choose
                Date</label>

            <div class="input-group date form_date col-md-5" data-date="" data-date-format="<%= format %>"
                 data-link-field="dtp_input2" data-link-format="<%= format %>">
                <input class="form-control" size="16" type="text" value="" readonly="">
                <!--<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>-->
                <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
            </div>
            <input type="hidden" id="dtp_input2" value="<%= currDate %>"><br>
        </div>
        <div id="echarts" style="width: 888px; height: 400px; margin: 0"></div>
    </div>
</div>
<script>
    $("#power").addClass('active');
    var period = $("#period").val();
    $("#" + period).addClass('active');

    var startView = 2;
    var minView = 2;
    if (period === 'bymonth') {
        startView = 3;
        minView = 3;
    } else if (period === 'byyear') {
        startView = 4;
        minView = 4;
    } else if (period === 'bytotal') {
        $(".form-group").hide();
    }

    $('.form_date').datetimepicker({
        language:  'en',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: startView,
        minView: minView,
        forceParse: 0
    }).on('changeDate', function (ev) {
        showCharts(period,$("#dtp_input2").val()||'2014-05-05');
    });

    var showCharts=function(period,date){

        var myChart = echarts.init(document.getElementById('echarts'));

        $.getJSON('/powerInfo/' + period + '/' + date, function (data) {
            var xdata = [];
            var ydata = [];
            var unit = data.dataunit;
            data = data.data;

            $.each(data, function (key, val) {

                xdata.push(val.time);
                ydata.push(val.value);
            });

            myChart.setOption({
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: ['发电量']
                },
                toolbox: {
                    show: true,
                    feature: {
                        mark: {show: true},
                        dataZoom: {show: true},
                        dataView: {show: true, readOnly: false},
                        magicType: {show: true, type: ['line', 'bar']},
                        restore: {show: true},
                        saveAsImage: {show: true}
                    }
                },
                calculable: true,
//                dataZoom: {
//                    show: true,
//                    height: 20,
//                    backgroundColor: 'rgba(221,160,221,0.5)',
//                    dataBackgroundColor: 'rgba(138,43,226,0.5)',
//                    fillerColor: 'rgba(38,143,26,0.6)',
//                    handleColor: 'rgba(128,43,16,0.8)',
//                    start: 0,
//                    end: 10
//                },
                xAxis: [
                    {
                        type: 'category',
                        data: xdata
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        axisLabel: {
                            formatter: '{value} ' + unit
                        },
                        splitArea: {show: true}
                    }
                ],
                series: [
                    {
                        name: '发电量',
                        type: 'bar',
                        data: ydata
                    }
                ]
            });
        });
    };

    showCharts(period,$("#dtp_input2").val());
</script>
<%- include common/footer.ejs %>